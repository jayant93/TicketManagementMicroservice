package exila.user.management.service.impl;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import exila.user.management.dto.UserDto;
import exila.user.management.model.ExileUser;
import exila.user.management.repositories.UserRespository;
import exila.user.management.respopnse.UserResponse;
import exila.user.management.service.UserManagement;

/**
 * 
 * @author jayantkumar
 *
 */
@Service
public class UserManagementImpl implements UserManagement {

	@Autowired
	UserRespository repo;

	@Autowired
	ModelMapper mapper;

	@Override
	public UserResponse createUser(UserDto dto) {

		ExileUser user = mapper.map(dto, ExileUser.class);

		// now generate op and send email

		Long otp = Math.abs(Math.round((Math.random() * (Integer.MAX_VALUE - Integer.MIN_VALUE)) + Integer.MIN_VALUE));

		user.setOtp(otp);

		user = repo.save(user);

		//This is an extra query for updation need to figure out to fix this
		user.getAddress().setUserId(user);
		user.getName().setUserId(user);

		
		user = repo.save(user);

		// now send email

		UserResponse response = mapper.map(user, UserResponse.class);

		return response;
	}

}
